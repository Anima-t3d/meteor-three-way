<head>
	<title>ThreeWay Demo</title>
</head>
<body>
	<div class="ui container">
		{{> DemoThreeWay}}
	</div>
</body>

<template name="DemoThreeWay">
	<h1>ThreeWay Demo</h1>
	
	<div class="column">
		<h3>Debug Messages</h3>
		<div class="ui form">
			{{#each clump allDebugMessages 4}}
				<div class="fields">
					{{#each this}}
						<div class="four wide field">
							<div class="ui checkbox">
								<input type="checkbox" value="{{this}}" data-bind="checked: debugMessages" name="debug-messages">
								<label><code>{{this}}</code></label>
							</div>
							
						</div>
					{{/each}}
				</div>
			{{/each}}
		</div>
	</div>
	
	<div class="column">
		&nbsp;
	</div>
	
	<div class="column">
		<h3>Show Me the Data (via a <code>#each</code> block iterating over a cursor)</h3>
		<table class="ui celled table">
			<thead>
				<tr>
					<th>Name</th>
					<th>e-mail Preferences</th>
					<th>Age</th>
					<th>Notes</th>
					<th>Tags</th>
					<th>Some Array</th>
					<th style="width: 150px;">Other Array</th>
					<th><button class="talk" data-bind="disabled: _3w_haveData|not">Disabled without Data</button></th>
				</tr>
			</thead>
			<tbody>
				{{#each data}}
					<tr>
						<td>{{name}}</td>
						<td>{{emailPrefsToCSL emailPrefs}}</td>
						<td>{{getProperty personal.particulars.age ageRanges}}</td>
						<td>{{notes}}</td>
						<td>{{join tags ', '}}</td>
						<td>
							<ol start="0">
								{{#each personal.someArr}}
									<li>{{this}}</li>
								{{/each}}
							</ol>
						</td>
						<td>
							<ol start="0">
								{{#each personal.otherArr}}
									<li>a: {{a}}; b: {{b}}</li>
								{{/each}}
							</ol>
						</td>
						<td>
							<button class="select-data" id="focus-{{_id}}">Edit</button>
						</td>
					</tr>
				{{/each}}
			</tbody>
		</table>
	</div>
	
	<div data-bind="visible: _3w_haveData">
		
		<div class="column">
			&nbsp;
		</div>
		<hr/>
		<div class="column">
			&nbsp;
		</div>
		
		<div class="column">
			<h3 id='edit-head'>Edit (View Model){{#if _3w_id}} - {{_3w_id}}{{/if}}</h3>
			
			<p>
				Requires <a href="https://atmospherejs.com/semantic/ui" target=_blank><code>semantic:ui</code></a> for the multi-select dropdown. (Start Meteor, do a trivial edit of <code>client/lib/semantic-ui/custom.semantic.json</code>, and save it to generate <a href="semantic-ui.com" target=_blank>Semantic UI</a>.)
			</p>
			
			<table class="ui celled table">
				<tr>
					<td><strong>Name</strong></td>
					<td><input name="name" style="border: 0; width: 100%;" data-bind="value: name"></td>
				</tr>
				<tr>
					<td><strong>e-mail Preferences</strong></td>
					<td>
						{{#each repackageDictionaryAsArray emailPrefsAll}}
							<div class="ui checkbox">
								<input type="checkbox" name="emailPrefs" value="{{key}}" data-bind="checked: emailPrefs">
								<label>{{value}}</label>
							</div>
						{{/each}}
					</td>
				</tr>
				<tr>
					<td><strong>Age</strong></td>
					<td>
						<div class="inline fields">
							{{#each repackageDictionaryAsArray ageRanges}}
								<div class="ui radio checkbox">
									<input type="radio" name="age" value="{{key}}" data-bind="checked: personal.particulars.age">
									<label>{{value}}</label>
								</div>
							{{/each}}
						</div>
					</td>
				</tr>
				<tr>
					<td><strong>Notes</strong></td>
					<td>
						<textarea data-bind="value: notes" style="border: 0; width: 100%;"></textarea>
					</td>
				</tr>
				<tr>
					<td style="color: #440;" data-bind="style: {background-color: tagsValidationErrorText|trueIfNonEmpty|grayIfTrue}">
						<strong>Tags</strong>
						<br>
						(Valid tags begin with "tag")
					</td>
					<td style="color: #440;" data-bind="style: {background-color: tagsValidationErrorText|trueIfNonEmpty|grayIfTrue}">
						<div class="ui fluid multiple search selection dropdown">
							<input name="tags" type="hidden" data-bind="value: tags|updateSemanticUIDropdown">
							<i class="dropdown icon"></i>
							<div class="default text">Select Tags</div>
							<div class="menu">
								{{#each allTags}}
									<div class="item" data-value="{{this}}">{{this}}</div>
								{{/each}}
							</div>
						</div>
						<div data-bind="html: tagsValidationErrorText; visible: tagsValidationErrorText|trueIfNonEmpty; style: {color: tagsValidationErrorText|trueIfNonEmpty|redIfTrue}"></div>
					</td>
				</tr>
				<tr>
					<td>
						<strong>personal.someArr</strong>
						<br>
						(#0 takes only numbers; #2 forbids "!" and "@")
					</td>
					<td>
						<div>
							{{#each range num}}
								<strong
								data-bind="style: {color: someArrValidationErrorText.{{this}}|trueIfNonEmpty|redIfTrue}"
								>
								#{{this}}:
								</strong>
								<input
								name="personal.someArr.{{this}}"
								style="width: 25%;" data-bind="value: personal.someArr.{{this}}; style: {color: someArrValidationErrorText.{{this}}|trueIfNonEmpty|redIfTrue}"
								>
							{{/each}}
						</div>
						<div style="color: blue; font-size: 0.7em;">
							Note that on selecting an item #1 and #2 appear later (via <code>setTimeout</code>) and are soon data bound.
						</div>
					</td>
				</tr>
				<tr>
					<td><strong>personal.otherArr[0]</strong></td>
					<td>
						<strong>a</strong>: <input style="width: 25%;" data-bind="value: personal.otherArr.0.a">
						<strong>b</strong>: <input style="width: 25%;" data-bind="value: personal.otherArr.0.b">
					</td>
				</tr>
				<tr>
					<td><strong>personal.otherArr[1]</strong></td>
					<td>
						<strong>a</strong>: <input style="width: 25%;" data-bind="value: personal.otherArr.1.a">
						<strong>b</strong>: <input style="width: 25%;" data-bind="value: personal.otherArr.1.b">
					</td>
				</tr>
			</table>
		</div>
		
		<div class="column">
			&nbsp;
		</div>
		<hr/>
		<div class="column">
			&nbsp;
		</div>
		
		
		<div class="column">
			<h3>Display (View Model){{#if _3w_id}} - {{_3w_id}}{{/if}}</h3>
			
			<table class="ui celled table">
				<tr>
					<td><strong>Name</strong></td>
					<td><span data-bind="html: name"></span></td>
				</tr>
				<tr>
					<td><strong>e-mail Preferences (bold if more than one)</strong></td>
					<td><span data-bind="html: emailPrefs|mapToEmailPrefs|boldIfMoreThanOne"></span></td>
				</tr>
				<tr>
					<td><strong>Age</strong></td>
					<td><span data-bind="html: personal.particulars.age|mapToAgeDisplay"></span></td>
				</tr>
				<tr>
					<td><strong>Notes</strong></td>
					<td><span data-bind="html: notes"></span></td>
				</tr>
				<tr>
					<td><strong>Tags</strong></td>
					<td><span data-bind="html: tags|tagsTextDisplay"></span></td>
				</tr>
				<tr>
					<td><strong>personal.someArr</strong></td>
					<td>
						<ol start="0">
							{{#each range 3}}
								<li><span data-bind="html: personal.someArr.{{this}}"></span></li>
							{{/each}}
						</ol>
					</td>
				</tr>
				<tr>
					<td><strong>personal.otherArr</strong></td>
					<td>
						<ol start="0">
							{{#each range 2}}
								<li>
									<ul>
										<li>
											a: <span data-bind="html: personal.otherArr.{{this}}.a"></span>&nbsp;&nbsp;
										</li>
										<li>
											b: <span data-bind="html: personal.otherArr.{{this}}.b"></span>
										</li>
									</ul>
									<br/>
								</li>
							{{/each}}
						</ol>
					</td>
				</tr>
			</table>
		</div>
		
	</div>
	
	<div class="column">
		&nbsp;
	</div>
	<hr/>
	<div class="column">
		&nbsp;
	</div>
	
	<div class="column">
		<h1>View Model Only Stuff</h1>
		
		<h3>Hide?</h3>
		<twdata field="hide" initial-value="view model to view only"></twdata>
		<div>
			hide (View Model Only): <input data-bind="value: hide">
		</div>
		<div>
			hide: <span data-bind="html: hide"></span>
		</div>
		
		<div style="background-color: red; width: 100%;" data-bind="visible: hide|sayHideToHide">
			<strong>Set <code>hide</code> to "hide" to Make this Disappear </strong>
		</div>
		<div>
			<strong>The above is actually a <code>style.display</code> binding... Anything other than "hide" will show the annoying <span style="color: red;">red</span> <code>div</code>.</strong>
		</div>
		
		<h3 data-bind="style: {color: fieldNameColor, font-size: fieldNameFontSize}">Heading Info</h3>
		<twdata field="fieldNameColor" initial-value="#0000FF"></twdata>
		<twdata field="fieldNameFontSize" initial-value="200%"></twdata>
		<twdata field="imgAltText" initial-value="Not Found ('not shouting; blame the processor)" processors="toUpperCase|appendTimeStamp"></twdata>
		<twdata field="semanticUIStyling" initial-value="yes"></twdata>
		<twdata field="sliderValue" initial-value="50"></twdata>
		
		<div data-bind="class: {ui: semanticUIStyling|noIsFalse, form: semanticUIStyling|noIsFalse}">
			<div class="field">
				<label>[Style binding] fieldNameColor (VM Only)</label>
				<input data-bind="value: fieldNameColor">
			</div>
			<div class="field">
				<label>[Style binding] fieldNameFontSize (VM Only)</label>
				<input data-bind="value: fieldNameFontSize">
			</div>
			<div class="field">
				<label>[Attribute binding] imgAltText (VM Only)</label>
				<input data-bind="value: imgAltText">
			</div>
			<img src="no-such-image.jpg" data-bind="attr: {alt: imgAltText}">
			<div class="field">
				<label>[Class binding] semanticUIStyling (VM Only; no means false) <code>semanticUIStyling|noIsFalse</code> --> <span data-bind="html: semanticUIStyling|noIsFalse"></span></label>
				<input data-bind="value: semanticUIStyling">
			</div>
			<div class="field">
				<label>[Value binding] sliderValue (VM Only); Drag to fire events; {{_3w_get 'sliderValue'}} &lt;-- via Blaze: <code>&#123;&#123;_3w_get 'sliderValue'&#125;&#125;</code></label>
				<input data-bind="value: sliderValue; event: {mousedown: dragStartHandler, mouseup: dragEndHandler|saySomethingHappy}" type="range" style="width: 100%" max=1000 min=0>
			</div>
		</div>
		
	</div>
	
	<div class="column">
		&nbsp;
	</div>
	<hr/>
	<div class="column">
		&nbsp;
	</div>
	
	<div class="column">
		<h1>Parent-Child-Sibling Data Access</h1>

		The following may look somewhat confused.
		But to summarize things, `ThreeWay`-linked template instances connected in parent-child relationships are able to access data from each other and the instances that are connected in the following way:
		<ul>
			<li>ancestor (any number of levels up)</li>
			<li>descendant (any number of levels down; requires knowledge of the relevant template instance identifiers of successive descendants passed into each template as <code>_3w_name</code> in data context)</li>
			<li>sibling (requires knowledge of the relevant template instance identifier passed into template as <code>_3w_name</code> in data context)</li>
		</ul>
		<button id="randomize-child-ids">Randomize Child (Data) Ids</button>
		
		<h3>Descendant Data</h3>
		<ul>
			<li><strong>Child Data <code>childData</code></strong>: {{_3w_childDataGet 'childData' 'kiddy'}}</li>
			<li><strong>Grandchild Data <code>grandchildData</code></strong>: {{_3w_childDataGet 'grandchildData' (arrayify2Args 'kiddy' 'grandkiddy')}}</li>
			<li><strong>Child Id</strong>: {{_3w_childDataGetId 'kiddy'}}</li>
			<li><strong>Grand Child One Id</strong>: {{_3w_childDataGetId (arrayify2Args 'kiddy' 'grandkiddy')}}</li>
			<li><strong>Grand Child Two Id</strong>: {{_3w_childDataGetId (arrayify2Args 'kiddy' 'other_grandkiddy')}}</li>
		</ul>
		
		<table class="ui table celled">
			<thead>
				<tr><th>Field ('grandkiddy')</th>
				<th>Value</th></tr>
			</thead>
			<tbody>
				{{#each repackageDictionaryAsArray (_3w_childDataGetAll (arrayify2Args 'kiddy' 'grandkiddy'))}}
					<tr>
						<td>{{key}}</td>
						<td>{{value}}</td>
					</tr>
				{{/each}}
			</tbody>
		</table>
	</div>
	
	{{> DemoThreeWayChild _3w_name='kiddy'}}
	
	<div class="column" style="height: 100px">
		&nbsp;
	</div>
	
</template>


<template name="DemoThreeWayChild">
	<h3>Child Template (Data Id: {{_3w_id}})</h3>
	<ul>
		<li><strong>Parent Data <code>sliderValue</code></strong>: {{_3w_parentDataGet 'sliderValue' 1}}</li>
		<li><strong>My Data <code>childData</code></strong>: <input data-bind="value: childData">&nbsp;&nbsp; {{_3w_get 'childData'}}</li>
	</ul>
	
	<table class="ui table celled">
		<thead>
			<tr><th>Field ('kiddy')</th>
			<th>Value</th></tr>
		</thead>
		<tbody>
			{{#each repackageDictionaryAsArray _3w_getAll}}
				<tr>
					<td>{{key}}</td>
					<td>{{value}}</td>
				</tr>
			{{/each}}
		</tbody>
	</table>
	
	<table class="ui table celled">
		<thead>
			<tr><th>Field ('grandkiddy')</th>
			<th>Value</th></tr>
		</thead>
		<tbody>
			{{#each repackageDictionaryAsArray (_3w_childDataGetAll 'grandkiddy')}}
				<tr>
					<td>{{key}}</td>
					<td>{{value}}</td>
				</tr>
			{{/each}}
		</tbody>
	</table>
	
	{{> DemoThreeWayGrandChild _3w_name='grandkiddy' initData="grandkiddy one" siblingName="other_grandkiddy"}}
	{{> DemoThreeWayGrandChild _3w_name='other_grandkiddy' initData="grandkiddy two" siblingName="grandkiddy"}}
</template>

<template name="DemoThreeWayGrandChild">
	<h3>Grandchild Template: <code>{{_3w_name}}</code> (Data Id: {{_3w_id}})</h3>
	<twdata field="grandchildData" initial-value="{{initData}}" restrict-template-type="DemoThreeWayGrandChild"></twdata>
	<twdata field="sharedBetweenParentAndGrandChild" initial-value="init sharedBetweenParentAndGrandChild" restrict-template-type="DemoThreeWay, DemoThreeWayGrandChild"></twdata>
	<twdata field="sharedBetweenChildAndGrandChild" initial-value="init sharedBetweenChildAndGrandChild" restrict-template-type="DemoThreeWayChild, DemoThreeWayGrandChild"></twdata>
	<ul>
		<li><strong>Grandparent Data <code>sliderValue</code></strong>: {{_3w_parentDataGet 'sliderValue' 2}}</li>
		<li><strong>My Data <code>grandchildData</code></strong>: <input data-bind="value: grandchildData">&nbsp;&nbsp; {{_3w_get 'grandchildData'}}</li>
		<li><strong>Sibling Data <code>{{siblingName}}.grandchildData</code></strong>: {{_3w_siblingDataGet 'grandchildData' siblingName}}</li>
	</ul>
	
	<table class="ui table celled">
		<thead>
			<tr><th>Field (Grandparent)</th>
			<th>Value</th></tr>
		</thead>
		<tbody>
			{{#each repackageDictionaryAsArray (_3w_parentDataGetAll 2)}}
				<tr>
					<td>{{key}}</td>
					<td>{{value}}</td>
				</tr>
			{{/each}}
		</tbody>
	</table>
	
	<table class="ui table celled">
		<thead>
			<tr><th>Field (Sibling: {{siblingName}})</th>
			<th>Value</th></tr>
		</thead>
		<tbody>
			{{#each repackageDictionaryAsArray (_3w_siblingDataGetAll siblingName)}}
				<tr>
					<td>{{key}}</td>
					<td>{{value}}</td>
				</tr>
			{{/each}}
		</tbody>
	</table>
	
</template>